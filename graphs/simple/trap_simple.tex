\documentclass[../../IA.tex]{subfiles}

\begin{document}

\newcommand{\sumdiv}{3}
\newcommand{\leftbound}{2}
\newcommand{\rightbound}{8}

\newcommand{\graphFunc}{\draw[darkgray, smooth, thick, samples=100, domain=\leftbound:\rightbound] plot(\x,{2*\x^3 + \x^2 + 3*\x + 1}) node[darkgray, align=left, right, yshift=0.5cm, xshift=-3.9cm] {\scriptsize \(f(x)\)};}
\begin{figure}[ht]
    \centering
    \resizebox{.6\textwidth}{!}{
        \begin{tikzpicture}[extended line/.style={shorten >=-#1,shorten <=-#1}]
            \pgfmathparse{int(\sumdiv-1)}
            \foreach \i in {0, ..., \pgfmathresult}
            {
                \pgfmathsetmacro\Ax{\leftbound + (((\rightbound - \leftbound)/\sumdiv)*\i)}
                \pgfmathsetmacro\Bx{\leftbound + (((\rightbound - \leftbound)/\sumdiv)*(\i+1))}
                \pgfmathsetmacro\Ay{2*\Ax^3 + \Ax^2 + 3*\Ax + 1}
                \pgfmathsetmacro\By{2*\Bx^3 + \Bx^2 + 3*\Bx + 1}
                \coordinate (BL) at (\Ax, 0);
                \coordinate (BR) at (\Bx, 0);
                \coordinate (TL) at (\Ax, \Ay);
                \coordinate (TR) at (\Bx, \By);
                \draw [gray, thin, pattern=north west lines, pattern color=gray] (BL) -- (BR) -- (TR) -- (TL) -- (BL);
            }

            \draw[black, thick] ({\leftbound-.1}, -0.02) -- ({\rightbound+.1}, -0.02) node[black, align=center, left, yshift=-0.13cm, xshift=-5.7cm] {\scriptsize \(x\)};
            \graphFunc
        \end{tikzpicture}
    }
    \vspace{-.8cm}
    \caption{Trapezoid Rule}
    \label{fig:trap_rule}
\end{figure}
\end{document}

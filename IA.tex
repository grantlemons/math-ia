\documentclass{paper}

\newcommand{\thetitle}{Methods of Adaptive Quadrature}
\newcommand{\researchquestion}{Comparing a new method of adaptive quadrature to an existing strategy.}
\newcommand{\theauthor}{Grant Lemons}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{XCharter}
\usepackage{fancyhdr}
\usepackage{subfiles}
\usepackage[section]{placeins}

% Tikz
\usepackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{patterns}
\usetikzlibrary{fpu}
\usetikzlibrary{spy}

% Tikz Graphs
\newcommand{\exampleLowSubintervals}{6}
\newcommand{\exampleHighSubintervals}{60}
\newcommand{\ruleEq}[1]{cos(#1 r)+1}
\newcommand{\simpleEq}[1]{((#1+(2/3))^3 + 2*(#1)^2)/6}
\newcommand{\complexEq}[1]{2*(sin((3)/(abs(#1)+.3) r)^2)}
\newcommand{\graphRule}{\draw[darkgray, smooth, thick, samples=100, domain={\leftbound-.05}:{\rightbound+.05}] plot(\x, {\ruleEq{\x}}) node[darkgray, align=left, right, yshift=0.5cm, xshift=-3.9cm] {\scriptsize \(f(x)\)};}
\newcommand{\graphSimple}{\draw[darkgray, smooth, thick, samples=100, domain={\leftbound-.05}:{\rightbound+.05}] plot(\x, {\simpleEq{\x}}) node[darkgray, align=left, right, yshift=-0.2cm, xshift=-3.0cm] {\tiny\(f(x)\)};}
\newcommand{\graphComplex}{\draw[darkgray, smooth, thick, samples=1500, domain={\leftbound-.05}:{\rightbound+.05}] plot(\x, {\complexEq{\x}}) node[darkgray, align=left, right, yshift=.15cm, xshift=-3.6cm] {\tiny\(f(x)\)};}

% Page Numbering
\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{\thepage}
\setlength{\headheight}{15pt}

% Equation Numbering
\newcommand*\tageq{\refstepcounter{equation}\tag{\theequation}}

\begin{document}
\thispagestyle{empty}
\insertTitlePage
\thispagestyle{empty}
\tableofcontents
\newpage
\setcounter{page}{1}

\section{Background}
\subsection{Rectangle Rule}
\noindent
The problem of finding the area contained by a function is more complex than it might appear.
While most constrained areas can be found easily using integration, some mathematical models are too complex or too time-consuming to integrate by hand.
As such, many methods have been developed to allow computers to approximate area by filling it with shapes of known area.
This general field of mathematical study is known as quadrature, and contains many established methods used to quickly and accurately approximate the function.
The most basic method used to approximate area is the rectangle.
By splitting the interval to be integrated into smaller subintervals and fitting rectangles beneath the curve based on the value of the function at a bound of the subinterval's bound, area can be approximated to a reasonable degree of accuracy as shown by Figure~\ref{fig:rect_rule}.
Since the area of a rectangle is extremely easy to calculate, this method is extremely simple to implement using Equation~\ref{eqn:rect_rule}.

\begin{equation}
    \label{eqn:rect_rule}
    \int_a^b f(x) dx \approx \sum_{j=1}^n (x_{j-1} - x_i) \times f(x_i + x_{j+1})
\end{equation}

\subfile{graphs/rules/rect_rule}

\subsection{Trapezoid Rule}
\noindent
An alternative means typically used in place of this method utilizes trapezoids instead of rectangles.
Instead of picking a single point at which to base the height on, the trapezoid rule utilizes the value of the function at both the left and right bounds, and uses them to approximate a trapezoid under the curve.
The equation for a trapezoid~\eqref{eqn:trap_rule} is only marginally more complicated than Equation~\ref{eqn:rect_rule}, but provides significantly more accuracy as seen in Figure~\ref{fig:trap_rule}.

\begin{equation}
    \label{eqn:trap_rule}
    \int_a^b f(x) dx \approx \dfrac{b - a}{2n} \sum_{j=1}^n (f(x_{j-1})+f(x_{j}))
\end{equation}

\subfile{graphs/rules/trap_rule}

\subsection{Composite Simpson's 1/3 Rule}
\noindent
Beyond these simple methods, other techniques use polynomials in an attempt to fit the curve as closely as possible.
One such method is the Composite Simpson's 1/3 rule, which uses the left, right, and, mid-interval values of each subinterval to construct a polynomial. The use of polynomials allows the Composite Simpson's 1/3 rule to approximate the integrand with easily integrable functions that fit the integrand extremely closely as shown in Figure~\ref{fig:smps_rule}.

\subfile{graphs/rules/smps_rule}

\noindent
A polynomial that fit the function in each subinterval can be calculated using Lagrange Polynomial Interpolation as demonstrated in Equation~\ref{eqn:lagrange}, where the \(x\) and \(y\) values make up the coordinates of the left-bound, right-bound, and mid-interval values of the subinterval.

\begin{equation}
    \label{eqn:lagrange}
    P(x) = \sum_{j=1}^n y_j \prod_{\substack{k = 1 \\ k \neq j}}^n \dfrac{x - x_k}{x_j - x_k}
\end{equation}

\noindent
Expanding Equation~\ref{eqn:lagrange} with the points \(m\), \(a\), and \(b\) for midpoint, left-bound, and right-bounds respectively produces Equation~\ref{eqn:lagrange_smps} expressed below.

\begin{equation}
    \label{eqn:lagrange_smps}
    P(x) = f(a) \dfrac{(x - m)(x - b)}{(a - m)(a - b)} + f(m) \dfrac{(x - a)(x - b)}{(m - a)(m - b)} + f(b) \dfrac{(x - a)(x - m)}{(b - a)(b - m)}
\end{equation}

\noindent
As \(m\) represnts the midpoint \((a + b) / 2\), this can be stated in terms of \(a\) and \(b\) as demonstrated in Equation~\ref{eqn:lagrange_smps_ab}.

\begin{equation}
    \label{eqn:lagrange_smps_ab}
    \resizebox{.9\textwidth}{!} 
    {
    $P(x) = f(a) \dfrac{\left(x - \dfrac{a+b}{2}\right)\biggl(x - b\biggr)}{\left(a - \dfrac{a+b}{2}\right)\biggl(a - b\biggr)} + f\left(\dfrac{a+b}{2}\right) \dfrac{\biggl(x - a\biggr)\biggl(x - b\biggr)}{\left(\dfrac{a+b}{2} - a\right)\left(\dfrac{a+b}{2} - b\right)} + f(b) \dfrac{\biggl(x - a\biggr)\left(x - \dfrac{a+b}{2}\right)}{\biggl(b - a\biggr)\left(b - \dfrac{a+b}{2}\right)}$
    }
\end{equation}

\noindent
Utilizing integration by substitution, Equation~\ref{eqn:lagrange_smps_ab} can be integrated into the form expressed in Equation~\ref{eqn:smps_rule} below.

\begin{gather*}
\int_a^b P(x) dx = \dfrac{b - a}{6} \left[f(a) + 4f\left(\dfrac{a + b}{2}\right) + f(b)\right]                          \\
\dfrac{b - a}{2} = h                                                                                                    \\
\end{gather*}
\begin{align*}
    \int_a^b P(x) dx &= \dfrac{h}{3} \left[f(a) + 4f\left(\dfrac{a + b}{2}\right) + f(b)\right]                         \\
    \int_a^b P(x) dx &\approx \int_a^b f(x) dx                                                                          \\
    \int_a^b f(x) dx &\approx \dfrac{h}{3} \left[f(a) + 4f\left(\dfrac{a + b}{2}\right) + f(b)\right]  \tageq\label{eqn:smps_rule}
\end{align*}


\noindent
Equation~\ref{eqn:smps_rule} gives an approximate value for the integral of the subinterval using a single polynomial function.
Applying this methodology to the function as a whole, the equation for the approximate value of the interval consists of the sum of the values of each subinterval.
Expressed mathematically, the equation for the approximate value of the whole is as shown in Equations~\ref{eqn:composite_smps_rule}~and~\ref{eqn:smplfd_composite_smps_rule}.

\begin{equation}
    \label{eqn:composite_smps_rule}
    \int_a^b f(x) dx \approx \dfrac{h}{3} \sum_{j=1}^{n / 2} \biggl[f(x_{2j-2}) + 4f(x_{2j-1}) + f(x_{2j})\biggr]
\end{equation}

\noindent
Equation~\ref{eqn:composite_smps_rule} can be expressed in the form of Equation~\ref{eqn:smplfd_composite_smps_rule} for computational efficiency.

\begin{equation}
    \label{eqn:smplfd_composite_smps_rule}
    \int_a^b f(x) dx \approx \dfrac{h}{3} \left[f(a) + 4 \sum_{j=1}^{n / 2} f(x_{2j-2}) + 2  \sum_{j=1}^{n / 2 - 1} f(x_{2j}) + f(b)\right]
\end{equation}

\subsection{Effectiveness Examples}
\subsubsection{Simple Function}

The effectiveness of the trapezoid rule and the composite Simpson's 1/3 rule can be seen in Figures \ref{fig:trap_rule_simple} and \ref{fig:smps_rule_simple} below.
Both methods are effective at fitting the curve of a relatively simple function such as a polynomial with relatively few subintervals, but get significantly less effective the more complex the integrand.

\subfile{graphs/simple/trap_simple}
\subfile{graphs/simple/smps_simple}

Even with the relatively large subinterval size, these methods are effective, because the function has no fluctuations that the method would not account for with the subinterval count being used.
Because both methods only sample a few points of the integrand, if these are not representative of the integrand over the subinterval, the methods will not effectively approximate the integral value.

\subsubsection{Complex Function}
Had the integrand been more complex, as in Figures \ref{fig:trap_rule_complex_low} and \ref{fig:smps_rule_complex_low} below, the area enclosed by the fluctuations would not be taken into account by these two rules.

\subfile{graphs/complex/low/trap_complex_low}
\subfile{graphs/complex/low/smps_complex_low}

The only way to improve the accuracy of the estimate produced by these methods is to increase the number of subintervals.
The main issue with this, however, is that the methods consume a significant amount of processing power per subinterval.
By scaling the number of subintervals by a factor of \(n\), the number of calculations required also scales linearly by \(n\).
Although increasing the subinterval count is effective on complex portions of the integrand, it is inefficient and unnecessary over the portions of the integrand that are relatively simple.
This means we should seek to maximize subinterval count only when necessary, and, in all other circumstances, minimize subintervals.

\section{Adaptive Quadrature}
Adaptive Quadrature is the method of changing the width of each subinterval depending on the complexity of the function within each subinterval.
An easy-to-implement process calculates the values of both the trapezoid and composite Simpson's 1/3 rules for the current subinterval, compares the two, and---should they significantly differ---splits the subinterval in two and repeats the process.%~\ref{https://www.math.usm.edu/lambers/mat460/fall09/lecture30.pdf}

\subfile{graphs/complex/high/trap_complex_high}
\subfile{graphs/complex/high/smps_complex_high}

\end{document}
